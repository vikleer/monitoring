<p-toast></p-toast>

<p class="mb-3">Aquí puede ver sus monitorias</p>

<p-button
  icon="pi pi-plus"
  label="Crear"
  size="small"
  (onClick)="openCreateMonitoringModal()"
></p-button>

<div class="mt-3">
  @if (monitoring.length === 0) {
    <p class="text-gray-600">No hay monitorias creadas</p>
  }

  @if (monitoring.length > 0) {
    <p-table [value]="monitoring">
      <ng-template pTemplate="header">
        <tr>
          <th id="title">Título</th>
          <th id="subject">Asignatura</th>
          <th id="recurrence">Recurrencia</th>
          <th id="actions">Acciones</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-monitoring>
        <tr class="white-space-nowrap">
          <td>{{ monitoring.title }}</td>
          <td>{{ monitoring.subject.name }}</td>
          <td>
            {{
              monitoring.availabilities[0].recurrence.weekDays[0].day
                | appWeekDay
            }}
            de
            {{
              monitoring.availabilities[0].recurrence.weekDays[0].time.start
                | appMilitaryToNormalTime
            }}
            a
            {{
              monitoring.availabilities[0].recurrence.weekDays[0].time.end
                | appMilitaryToNormalTime
            }}
          </td>
          <td>
            <div class="flex gap-2">
              <p-button
                role="link"
                icon="pi pi-info"
                pTooltip="Ver detalle monitoria"
                tooltipPosition="bottom"
                [routerLink]="['/monitoring', monitoring.id]"
                [rounded]="true"
                [outlined]="true"
              ></p-button>
              <p-button
                pTooltip="Editar monitoria"
                tooltipPosition="bottom"
                icon="pi pi-pencil"
                [rounded]="true"
                [outlined]="true"
                (onClick)="openEditMonitoringModal(monitoring)"
              ></p-button>
              <p-button
                pTooltip="Cancelar monitoria"
                tooltipPosition="bottom"
                icon="pi pi-ban"
                [rounded]="true"
                [outlined]="true"
                (onClick)="cancelMonitoring(monitoring)"
              ></p-button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  }
</div>

<p-dialog
  class="dialog"
  header="Crear monitoria"
  [(visible)]="isCreateMonitoringModalOpen"
  [modal]="true"
  [dismissableMask]="true"
  [draggable]="false"
  [resizable]="false"
>
  <div class="flex flex-column gap-3 overflow-hidden">
    <app-monitoring-management
      (formSubmitted)="createMonitoring($event)"
      (formCancelled)="closeCreateMonitoringModal()"
    ></app-monitoring-management>
  </div>
</p-dialog>

<p-dialog
  class="dialog"
  header="Editar monitoria"
  [(visible)]="isEditMonitoringModalOpen"
  [modal]="true"
  [dismissableMask]="true"
  [draggable]="false"
  [resizable]="false"
>
  <div class="flex flex-column gap-3 overflow-hidden">
    <app-monitoring-management
      mode="edit"
      [monitoring]="monitoringToEdit"
      (formSubmitted)="editMonitoring($event)"
      (formCancelled)="closeEditMonitoringModal()"
    ></app-monitoring-management>
  </div>
</p-dialog>

<p-confirmDialog></p-confirmDialog>
